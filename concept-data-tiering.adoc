---
sidebar: sidebar 
permalink: concept-data-tiering.html 
keywords: storage tiering, tier, tiering, data tiering, s3, s3 tiering, capacity, performance, s3 endpoint, fabric pool, fabricpool, s3 bucket, requirement, vpc endpoint, policy, policies, tiering policies, auto, snapshot only, backup, none, cooling period, volume tiering policies, blob, standard, infrequent access, hot, cool, tiering level, storage tier, storage class 
summary: 透過將冷資料自動分層到低成本物件儲存來降低儲存成本。 
---
= 了解 AWS、Azure 或 Google Cloud 中的Cloud Volumes ONTAP資料分層
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
透過將非活動資料自動分層到低成本物件儲存來降低儲存成本。活動資料保留在高效能 SSD 或 HDD 中，而非活動資料則分層到低成本物件儲存中。這使您能夠回收主儲存上的空間並縮小輔助儲存。

image:diagram_data_tiering.png["這是概念圖，顯示熱數據進入 EBS 存儲，非活動數據進入 S3 存儲。"]

資料分層由FabricPool技術提供支援。 Cloud Volumes ONTAP為所有Cloud Volumes ONTAP叢集提供資料分層，無需額外的授權。當您啟用資料分層時，分層到物件儲存的資料會產生費用。有關對象儲存成本的詳細信息，請參閱雲端提供者的文檔。

ifdef::aws[]



== AWS 中的資料分層

當您在 AWS 中啟用資料分層時， Cloud Volumes ONTAP會使用 EBS 作為熱資料的效能層，並使用 AWS S3 作為非活動資料的容量層。

性能層:: 性能層可以是通用 SSD（gp3 或 gp2）或預先配置 IOPS SSD（io1）。
+
--
使用吞吐量最佳化 HDD (st1) 時，不建議將資料分層到物件儲存。

--
容量層:: Cloud Volumes ONTAP系統將非活動資料分層到單一 S3 儲存桶。
+
--
NetApp控制台為每個系統建立一個 S3 儲存桶，並將其命名為 fabric-pool-_cluster unique identifier_。不會為每個磁碟區建立不同的 S3 儲存桶。

當控制台建立 S3 儲存桶時，它會使用以下預設設定：

* 儲存類別：標準
* 預設加密：已停用
* 阻止公共訪問：阻止所有公共訪問
* 物件所有權：已啟用 ACL
* 儲存桶版本控制：已停用
* 物件鎖定：已停用


--
儲存類別:: AWS 中分層資料的預設儲存類別是「標準」。標準非常適合跨多個可用區域儲存的頻繁存取的資料。
+
--
如果您不打算存取非活動數據，則可以透過將儲存類別變更為以下之一來降低儲存成本：_智慧分層_、_單區不頻繁存取_、_標準不頻繁存取_或_S3 Glacier 即時檢索_。當您變更儲存類別時，非活動數據將從標準儲存類別開始，如果 30 天後未存取該數據，則將轉換到您選擇的儲存類別。

如果存取數據，存取成本會更高，因此在更改儲存類別之前請考慮這一點。 https://aws.amazon.com/s3/storage-classes["Amazon S3 文件：了解有關 Amazon S3 儲存類別的更多信息"^] 。

您可以在建立系統時選擇儲存類，之後可以隨時變更它。有關更改儲存類別的說明，請參閱link:task-tiering.html["將非活動資料分層到低成本物件存儲"]。

資料分層的儲存類別是系統範圍的 - 而不是每個磁碟區的。

--


endif::aws[]

ifdef::azure[]



== Azure 中的資料分層

當您在 Azure 中啟用資料分層時， Cloud Volumes ONTAP會使用 Azure 託管磁碟作為熱資料的效能層，並使用 Azure Blob 儲存作為非活動資料的容量層。

性能層:: 效能層可以是 SSD 或 HDD。
容量層:: Cloud Volumes ONTAP系統將非活動資料分層到單一 Blob 容器。
+
--
控制台為每個Cloud Volumes ONTAP系統建立一個帶有容器的新儲存帳戶。儲存帳戶的名稱是隨機的。不會為每個磁碟區建立不同的容器。

控制台使用以下設定建立儲存帳戶：

* 訪問層：熱
* 性能：標準
* 冗餘：根據 Cloud Volume ONTAP部署
+
** 單一可用區：本地冗餘儲存（LRS）
** 多可用區域：區域冗餘儲存（ZRS）


* 帳號：StorageV2（通用 v2）
* 要求 REST API 操作進行安全傳輸：已啟用
* 儲存帳戶金鑰存取：已啟用
* 最低 TLS 版本：版本 1.2
* 基礎設施加密：已停用


--
儲存存取層:: Azure 中分層資料的預設儲存存取層是_熱_層。熱層非常適合容量層中頻繁存取的資料。
+
--
如果您不打算存取容量層中的非活動數據，則可以選擇_cool_儲存層，其中非活動數據至少保留 30 天。您也可以選擇冷層，其中非活動資料至少儲存 90 天。根據您的儲存要求和成本考慮，您可以選擇最適合您需求的層。當您將儲存層變更為_cool_或_cold_時，非活動容量層資料將直接移至冷儲存層。與熱層相比，冷層提供的儲存成本較低，但存取成本較高，因此在更改儲存層之前請考慮這一點。參考 https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-storage-tiers["Microsoft Azure 文件：了解有關 Azure Blob 儲存存取層的更多信息"^]。

您可以在新增Cloud Volumes ONTAP系統時選擇一個儲存層，之後可以隨時變更它。有關更改儲存層的詳細信息，請參閱link:task-tiering.html["將非活動資料分層到低成本物件存儲"]。

資料分層的儲存存取層是系統範圍的，而不是每個磁碟區的。

--


endif::azure[]

ifdef::gcp[]



== Google Cloud 中的資料分層

當您在 Google Cloud 中啟用資料分層時， Cloud Volumes ONTAP會使用持久磁碟作為熱資料的效能層，並使用 Google Cloud Storage 儲存桶作為非活動資料的容量層。

性能層:: 效能層可以是 SSD 持久性磁碟、平衡持久性磁碟或標準持久性磁碟。
容量層:: Cloud Volumes ONTAP系統將非活動資料分層到單一 Google Cloud Storage 儲存桶。
+
--
控制台為每個系統建立一個儲存桶並將其命名為 fabric-pool-_cluster unique identifier_。不會為每個磁碟區建立不同的儲存桶。

當控制台建立儲存桶時，它使用以下預設設定：

* 位置類型：區域
* 儲存類別：標準
* 公共存取：受物件 ACL 約束
* 存取控制：細粒度
* 保護：無
* 資料加密：Google 管理的金鑰


--
儲存類別:: 分層資料的預設儲存類別是「標準儲存」類別。如果資料不經常訪問，您可以透過變更為_Nearline Storage_或_Coldline Storage_來降低儲存成本。當您變更儲存類別時，後續非活動資料將直接移至您選擇的類別。
+
--

NOTE: 當您變更儲存類別時，任何現有的非活動資料都將保持預設儲存類別。若要變更現有非活動資料的儲存類別，您必須手動執行指定。

如果您確實存取數據，存取成本會更高，因此在更改儲存類別之前請考慮這一點。要了解更多信息，請參閱 https://cloud.google.com/storage/docs/storage-classes["Google Cloud 文件：儲存類別"^]。

您可以在建立系統時選擇一個儲存層，之後可以隨時變更它。有關更改存儲類別的詳細信息，請參閱link:task-tiering.html["將非活動資料分層到低成本物件存儲"]。

資料分層的儲存類別是系統範圍的 - 而不是每個磁碟區的。

--


endif::gcp[]



== 資料分層和容量限制

如果啟用資料分層，系統的容量限制將保持不變。此限制分佈在性能層和容量層。



== 卷分層策略

若要啟用資料分層，您必須在建立、修改或複製磁碟區時選擇磁碟區分層策略。您可以為每個磁碟區選擇不同的策略。

一些分層策略具有相關的最小冷卻期，該冷卻期規定了磁碟區中的使用者資料必須保持不活動的時間，以便資料被視為「冷」並移動到容量層。當資料寫入聚合時，冷卻期開始。


TIP: 您可以變更最短冷卻期和 50% 的預設聚合閾值（更多內容請見下文）。 http://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-mgng-stor-tier-fp/GUID-AD522711-01F9-4413-A254-929EAE871EBF.html["了解如何更改冷卻時間"^]和 http://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-mgng-stor-tier-fp/GUID-8FC4BFD5-F258-4AA6-9FCB-663D42D92CAA.html["學習如何改變閾值"^]。

控制台可讓您在建立或修改磁碟區時從下列磁碟區分層原則中進行選擇：

僅限快照:: 當聚合達到 50% 容量後， Cloud Volumes ONTAP會將與活動檔案系統不關聯的 Snapshot 副本的冷用戶資料分層到容量層。冷卻期約為2天。
+
--
如果讀取，容量層上的冷資料塊會變熱並被移動到效能層。

--
全部:: 所有數據（不包括元數據）都會立即標記為冷數據，並儘快分層到物件儲存。無需等待 48 小時讓卷中的新區塊變冷。請注意，在設定「全部」策略之前位於磁碟區中的區塊需要 48 小時才能冷卻。
+
--
如果讀取，雲層上的冷資料塊將保持冷狀態並且不會寫回效能層。此策略從ONTAP 9.6 開始可用。

--
汽車:: 當聚合達到 50% 容量後， Cloud Volumes ONTAP會將磁碟區中的冷資料塊分層到容量層。冷資料不僅包括 Snapshot 副本，還包括來自活動檔案系統的冷用戶資料。冷卻期約為31天。
+
--
從Cloud Volumes ONTAP 9.4 開始支援此策略。

如果透過隨機讀取，容量層中的冷資料塊會變熱並移動到效能層。如果透過順序讀取（例如與索引和防毒掃描相關的讀取），冷資料區塊將保持冷狀態並且不會移動到效能層。

--
沒有任何:: 將磁碟區的資料保留在效能層中，防止其移動到容量層。


複製磁碟區時，您可以選擇是否將資料分層到物件儲存。如果這樣做，控制台會將*備份*政策套用至資料保護磁碟區。從Cloud Volumes ONTAP 9.6 開始，*全部*分層策略取代了備份策略。



=== 關閉Cloud Volumes ONTAP會影響冷卻期

資料塊透過冷卻掃描進行冷卻。在此過程中，未使用的塊的溫度將移動（冷卻）到下一個較低的值。預設冷卻時間取決於磁碟區分層策略：

* 自動：31天
* 僅限快照：2 天


必須執行Cloud Volumes ONTAP才能使冷卻掃描正常運作。如果關閉Cloud Volumes ONTAP ，冷卻也會停止。因此，您可以體驗更長的冷卻時間。


TIP: 當Cloud Volumes ONTAP關閉時，每個區塊的溫度都會保留，直到您重新啟動系統。例如，如果關閉系統時某個區塊的溫度為 5，則重新開啟系統時溫度仍為 5。



== 設定資料分層

有關說明和受支援配置的列表，請參閱link:task-tiering.html["將非活動資料分層到低成本物件存儲"]。
